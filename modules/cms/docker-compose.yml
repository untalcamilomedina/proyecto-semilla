# CMS Module Docker Configuration
# Generated by Vibecoding

version: '3.8'

services:
  cms-db:
    image: postgres:15
    environment:
      POSTGRES_DB: cms_module
      POSTGRES_USER: cms_user
      POSTGRES_PASSWORD: cms_password
    volumes:
      - cms_postgres_data:/var/lib/postgresql/data
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5433:5432"  # Different port to avoid conflicts
    networks:
      - cms-network

  cms-redis:
    image: redis:7-alpine
    ports:
      - "6380:6379"  # Different port to avoid conflicts
    networks:
      - cms-network

  cms-backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    environment:
      DATABASE_URL: postgresql://cms_user:cms_password@cms-db:5432/cms_module
      REDIS_URL: redis://cms-redis:6379
      ENVIRONMENT: development
    ports:
      - "8002:8000"  # Different port to avoid conflicts with main MCP server
    depends_on:
      - cms-db
      - cms-redis
    volumes:
      - ./backend:/app
    networks:
      - cms-network

  cms-frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    environment:
      REACT_APP_API_URL: http://localhost:8002
      NODE_ENV: development
    ports:
      - "3001:3000"  # Different port to avoid conflicts
    depends_on:
      - cms-backend
    volumes:
      - ./frontend:/app
      - /app/node_modules
    networks:
      - cms-network

volumes:
  cms_postgres_data:

networks:
  cms-network:
    driver: bridge