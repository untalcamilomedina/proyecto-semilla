<?xml version="1.0" encoding="utf-8"?><testsuites><testsuite name="pytest" errors="9" failures="14" skipped="0" tests="32" time="3.086" timestamp="2025-09-05T12:11:47.243853" hostname="Mac-mini-de-Camilo.local"><testcase classname="tests.integration.test_api_endpoints.TestHealthEndpoint" name="test_health_check" time="0.076"><failure message="AttributeError: '_StreamingResponse' object has no attribute 'body'">../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:98: in receive
    return self.receive_nowait()
../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:93: in receive_nowait
    raise WouldBlock
E   anyio.WouldBlock

During handling of the above exception, another exception occurred:
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:78: in call_next
    message = await recv_stream.receive()
../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:118: in receive
    raise EndOfStream
E   anyio.EndOfStream

During handling of the above exception, another exception occurred:
tests/integration/test_api_endpoints.py:16: in test_health_check
    response = test_client.get("/health")
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:499: in get
    return super().get(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1041: in get
    return self.request(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in request
    return super().request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:342: in handle_request
    raise exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:339: in handle_request
    portal.call(self.app, scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:184: in __call__
    raise exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:162: in __call__
    await self.app(scope, receive, _send)
backend/app/core/rate_limiting.py:423: in __call__
    await self.app(scope, receive, send_with_headers)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/middleware/compression.py:124: in dispatch
    response = await call_next(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/middleware/compression.py:38: in dispatch
    if len(response.body) &lt; self.minimum_size:
E   AttributeError: '_StreamingResponse' object has no attribute 'body'</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestAuthentication" name="test_login_success" time="0.025"><error message="failed on setup with &quot;RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop&quot;">tests/conftest.py:71: in test_client
    with TestClient(app) as client:
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:745: in __enter__
    portal.call(self.wait_startup)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:780: in wait_startup
    await receive()
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:771: in receive
    self.task.result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:438: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:761: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:149: in __call__
    await self.app(scope, receive, send)
backend/app/core/rate_limiting.py:371: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:75: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:55: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:707: in __call__
    await self.lifespan(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:677: in lifespan
    async with self.lifespan_context(app) as maybe_state:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
backend/app/main.py:34: in lifespan
    await create_tables()
backend/app/core/database.py:54: in create_tables
    async with engine.begin() as conn:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:1061: in begin
    async with conn:
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/base.py:125: in __aenter__
    return await self.start(is_ctxmanager=True)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:270: in start
    await greenlet_spawn(self.sync_engine.connect)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:190: in greenlet_spawn
    result = context.throw(*sys.exc_info())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3268: in connect
    return self._connection_cls(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:145: in __init__
    self._dbapi_connection = engine.raw_connection()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3292: in raw_connection
    return self.pool.connect()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:452: in connect
    return _ConnectionFairy._checkout(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1378: in _checkout
    del fairy
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1306: in _checkout
    result = pool._dialect._do_ping_w_event(
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/default.py:709: in _do_ping_w_event
    return self.do_ping(dbapi_connection)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1137: in do_ping
    dbapi_connection.ping()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:829: in ping
    self._handle_exception(error)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:810: in _handle_exception
    raise error
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:827: in ping
    _ = self.await_(self._async_ping())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:125: in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:185: in greenlet_spawn
    value = await result
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:836: in _async_ping
    await tr.start()
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/transaction.py:146: in start
    await self._connection.execute(query)
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/connection.py:350: in execute
    result = await self._protocol.query(query, timeout)
asyncpg/protocol/protocol.pyx:374: in query
    ???
E   RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop</error></testcase><testcase classname="tests.integration.test_api_endpoints.TestAuthentication" name="test_login_invalid_credentials" time="0.036"><failure message="AttributeError: '_StreamingResponse' object has no attribute 'body'">../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:98: in receive
    return self.receive_nowait()
../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:93: in receive_nowait
    raise WouldBlock
E   anyio.WouldBlock

During handling of the above exception, another exception occurred:
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:78: in call_next
    message = await recv_stream.receive()
../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:118: in receive
    raise EndOfStream
E   anyio.EndOfStream

During handling of the above exception, another exception occurred:
tests/integration/test_api_endpoints.py:46: in test_login_invalid_credentials
    response = test_client.post(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:590: in post
    return super().post(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1132: in post
    return self.request(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in request
    return super().request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:342: in handle_request
    raise exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:339: in handle_request
    portal.call(self.app, scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:184: in __call__
    raise exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:162: in __call__
    await self.app(scope, receive, _send)
backend/app/core/rate_limiting.py:423: in __call__
    await self.app(scope, receive, send_with_headers)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/middleware/compression.py:124: in dispatch
    response = await call_next(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/middleware/compression.py:38: in dispatch
    if len(response.body) &lt; self.minimum_size:
E   AttributeError: '_StreamingResponse' object has no attribute 'body'</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestAuthentication" name="test_refresh_token" time="0.005"><error message="failed on setup with &quot;RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop&quot;">tests/conftest.py:71: in test_client
    with TestClient(app) as client:
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:745: in __enter__
    portal.call(self.wait_startup)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:780: in wait_startup
    await receive()
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:771: in receive
    self.task.result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:438: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:761: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:149: in __call__
    await self.app(scope, receive, send)
backend/app/core/rate_limiting.py:371: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:75: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:55: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:707: in __call__
    await self.lifespan(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:677: in lifespan
    async with self.lifespan_context(app) as maybe_state:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
backend/app/main.py:34: in lifespan
    await create_tables()
backend/app/core/database.py:54: in create_tables
    async with engine.begin() as conn:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:1061: in begin
    async with conn:
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/base.py:125: in __aenter__
    return await self.start(is_ctxmanager=True)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:270: in start
    await greenlet_spawn(self.sync_engine.connect)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:190: in greenlet_spawn
    result = context.throw(*sys.exc_info())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3268: in connect
    return self._connection_cls(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:145: in __init__
    self._dbapi_connection = engine.raw_connection()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3292: in raw_connection
    return self.pool.connect()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:452: in connect
    return _ConnectionFairy._checkout(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1378: in _checkout
    del fairy
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1306: in _checkout
    result = pool._dialect._do_ping_w_event(
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/default.py:709: in _do_ping_w_event
    return self.do_ping(dbapi_connection)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1137: in do_ping
    dbapi_connection.ping()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:829: in ping
    self._handle_exception(error)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:810: in _handle_exception
    raise error
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:827: in ping
    _ = self.await_(self._async_ping())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:125: in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:185: in greenlet_spawn
    value = await result
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:836: in _async_ping
    await tr.start()
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/transaction.py:146: in start
    await self._connection.execute(query)
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/connection.py:350: in execute
    result = await self._protocol.query(query, timeout)
asyncpg/protocol/protocol.pyx:374: in query
    ???
E   RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop</error></testcase><testcase classname="tests.integration.test_api_endpoints.TestArticlesAPI" name="test_get_articles_unauthorized" time="0.039"><failure message="fastapi.exceptions.HTTPException">../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:98: in receive
    return self.receive_nowait()
../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:93: in receive_nowait
    raise WouldBlock
E   anyio.WouldBlock

During handling of the above exception, another exception occurred:
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:78: in call_next
    message = await recv_stream.receive()
../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:118: in receive
    raise EndOfStream
E   anyio.EndOfStream

During handling of the above exception, another exception occurred:
tests/integration/test_api_endpoints.py:84: in test_get_articles_unauthorized
    response = test_client.get("/api/v1/articles")
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:499: in get
    return super().get(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1041: in get
    return self.request(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in request
    return super().request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:342: in handle_request
    raise exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:339: in handle_request
    portal.call(self.app, scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:184: in __call__
    raise exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:162: in __call__
    await self.app(scope, receive, _send)
backend/app/core/rate_limiting.py:423: in __call__
    await self.app(scope, receive, send_with_headers)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/middleware/compression.py:124: in dispatch
    response = await call_next(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/middleware/compression.py:35: in dispatch
    response = await call_next(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/core/audit_logging.py:601: in log_request_middleware
    response = await call_next(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/core/middleware.py:101: in tenant_context_middleware
    raise e
backend/app/core/middleware.py:57: in tenant_context_middleware
    raise HTTPException(
E   fastapi.exceptions.HTTPException</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestArticlesAPI" name="test_get_articles_authorized" time="0.005"><error message="failed on setup with &quot;RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop&quot;">tests/conftest.py:71: in test_client
    with TestClient(app) as client:
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:745: in __enter__
    portal.call(self.wait_startup)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:780: in wait_startup
    await receive()
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:771: in receive
    self.task.result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:438: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:761: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:149: in __call__
    await self.app(scope, receive, send)
backend/app/core/rate_limiting.py:371: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:75: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:55: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:707: in __call__
    await self.lifespan(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:677: in lifespan
    async with self.lifespan_context(app) as maybe_state:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
backend/app/main.py:34: in lifespan
    await create_tables()
backend/app/core/database.py:54: in create_tables
    async with engine.begin() as conn:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:1061: in begin
    async with conn:
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/base.py:125: in __aenter__
    return await self.start(is_ctxmanager=True)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:270: in start
    await greenlet_spawn(self.sync_engine.connect)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:190: in greenlet_spawn
    result = context.throw(*sys.exc_info())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3268: in connect
    return self._connection_cls(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:145: in __init__
    self._dbapi_connection = engine.raw_connection()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3292: in raw_connection
    return self.pool.connect()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:452: in connect
    return _ConnectionFairy._checkout(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1378: in _checkout
    del fairy
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1306: in _checkout
    result = pool._dialect._do_ping_w_event(
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/default.py:709: in _do_ping_w_event
    return self.do_ping(dbapi_connection)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1137: in do_ping
    dbapi_connection.ping()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:829: in ping
    self._handle_exception(error)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:810: in _handle_exception
    raise error
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:827: in ping
    _ = self.await_(self._async_ping())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:125: in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:185: in greenlet_spawn
    value = await result
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:836: in _async_ping
    await tr.start()
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/transaction.py:146: in start
    await self._connection.execute(query)
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/connection.py:350: in execute
    result = await self._protocol.query(query, timeout)
asyncpg/protocol/protocol.pyx:374: in query
    ???
E   RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop</error></testcase><testcase classname="tests.integration.test_api_endpoints.TestArticlesAPI" name="test_create_article" time="0.047"><failure message="TypeError: 'coroutine' object is not iterable">tests/integration/test_api_endpoints.py:106: in test_create_article
    response = test_client.post(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:590: in post
    return super().post(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1132: in post
    return self.request(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in request
    return super().request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:801: in request
    request = self.build_request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:347: in build_request
    headers = self._merge_headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:414: in _merge_headers
    merged_headers.update(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:199: in update
    headers = Headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:79: in __init__
    self._list = [
E   TypeError: 'coroutine' object is not iterable</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestArticlesAPI" name="test_get_article_by_id" time="0.006"><error message="failed on setup with &quot;RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop&quot;">tests/conftest.py:71: in test_client
    with TestClient(app) as client:
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:745: in __enter__
    portal.call(self.wait_startup)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:780: in wait_startup
    await receive()
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:771: in receive
    self.task.result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:438: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:761: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:149: in __call__
    await self.app(scope, receive, send)
backend/app/core/rate_limiting.py:371: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:75: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:55: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:707: in __call__
    await self.lifespan(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:677: in lifespan
    async with self.lifespan_context(app) as maybe_state:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
backend/app/main.py:34: in lifespan
    await create_tables()
backend/app/core/database.py:54: in create_tables
    async with engine.begin() as conn:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:1061: in begin
    async with conn:
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/base.py:125: in __aenter__
    return await self.start(is_ctxmanager=True)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:270: in start
    await greenlet_spawn(self.sync_engine.connect)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:190: in greenlet_spawn
    result = context.throw(*sys.exc_info())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3268: in connect
    return self._connection_cls(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:145: in __init__
    self._dbapi_connection = engine.raw_connection()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3292: in raw_connection
    return self.pool.connect()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:452: in connect
    return _ConnectionFairy._checkout(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1378: in _checkout
    del fairy
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1306: in _checkout
    result = pool._dialect._do_ping_w_event(
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/default.py:709: in _do_ping_w_event
    return self.do_ping(dbapi_connection)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1137: in do_ping
    dbapi_connection.ping()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:829: in ping
    self._handle_exception(error)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:810: in _handle_exception
    raise error
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:827: in ping
    _ = self.await_(self._async_ping())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:125: in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:185: in greenlet_spawn
    value = await result
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:836: in _async_ping
    await tr.start()
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/transaction.py:146: in start
    await self._connection.execute(query)
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/connection.py:350: in execute
    result = await self._protocol.query(query, timeout)
asyncpg/protocol/protocol.pyx:374: in query
    ???
E   RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop</error></testcase><testcase classname="tests.integration.test_api_endpoints.TestArticlesAPI" name="test_update_article" time="0.063"><failure message="AttributeError: 'coroutine' object has no attribute 'id'">tests/integration/test_api_endpoints.py:136: in test_update_article
    f"/api/v1/articles/{test_article.id}",
E   AttributeError: 'coroutine' object has no attribute 'id'</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestArticlesAPI" name="test_delete_article" time="0.035"><failure message="AttributeError: 'coroutine' object has no attribute 'id'">tests/integration/test_api_endpoints.py:147: in test_delete_article
    f"/api/v1/articles/{test_article.id}",
E   AttributeError: 'coroutine' object has no attribute 'id'</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestArticlesAPI" name="test_get_article_stats" time="0.030"><failure message="TypeError: 'coroutine' object is not iterable">tests/integration/test_api_endpoints.py:161: in test_get_article_stats
    response = test_client.get(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:499: in get
    return super().get(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1041: in get
    return self.request(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in request
    return super().request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:801: in request
    request = self.build_request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:347: in build_request
    headers = self._merge_headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:414: in _merge_headers
    merged_headers.update(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:199: in update
    headers = Headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:79: in __init__
    self._list = [
E   TypeError: 'coroutine' object is not iterable</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestCategoriesAPI" name="test_get_categories" time="0.005"><error message="failed on setup with &quot;RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop&quot;">tests/conftest.py:71: in test_client
    with TestClient(app) as client:
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:745: in __enter__
    portal.call(self.wait_startup)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:780: in wait_startup
    await receive()
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:771: in receive
    self.task.result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:438: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:761: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:149: in __call__
    await self.app(scope, receive, send)
backend/app/core/rate_limiting.py:371: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:75: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:55: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:707: in __call__
    await self.lifespan(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:677: in lifespan
    async with self.lifespan_context(app) as maybe_state:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
backend/app/main.py:34: in lifespan
    await create_tables()
backend/app/core/database.py:54: in create_tables
    async with engine.begin() as conn:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:1061: in begin
    async with conn:
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/base.py:125: in __aenter__
    return await self.start(is_ctxmanager=True)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:270: in start
    await greenlet_spawn(self.sync_engine.connect)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:190: in greenlet_spawn
    result = context.throw(*sys.exc_info())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3268: in connect
    return self._connection_cls(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:145: in __init__
    self._dbapi_connection = engine.raw_connection()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3292: in raw_connection
    return self.pool.connect()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:452: in connect
    return _ConnectionFairy._checkout(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1378: in _checkout
    del fairy
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1306: in _checkout
    result = pool._dialect._do_ping_w_event(
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/default.py:709: in _do_ping_w_event
    return self.do_ping(dbapi_connection)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1137: in do_ping
    dbapi_connection.ping()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:829: in ping
    self._handle_exception(error)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:810: in _handle_exception
    raise error
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:827: in ping
    _ = self.await_(self._async_ping())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:125: in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:185: in greenlet_spawn
    value = await result
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:836: in _async_ping
    await tr.start()
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/transaction.py:146: in start
    await self._connection.execute(query)
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/connection.py:350: in execute
    result = await self._protocol.query(query, timeout)
asyncpg/protocol/protocol.pyx:374: in query
    ???
E   RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop</error></testcase><testcase classname="tests.integration.test_api_endpoints.TestCategoriesAPI" name="test_create_category" time="0.042"><failure message="TypeError: 'coroutine' object is not iterable">tests/integration/test_api_endpoints.py:192: in test_create_category
    response = test_client.post(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:590: in post
    return super().post(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1132: in post
    return self.request(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in request
    return super().request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:801: in request
    request = self.build_request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:347: in build_request
    headers = self._merge_headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:414: in _merge_headers
    merged_headers.update(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:199: in update
    headers = Headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:79: in __init__
    self._list = [
E   TypeError: 'coroutine' object is not iterable</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestUsersAPI" name="test_get_users" time="0.005"><error message="failed on setup with &quot;RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop&quot;">tests/conftest.py:71: in test_client
    with TestClient(app) as client:
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:745: in __enter__
    portal.call(self.wait_startup)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:780: in wait_startup
    await receive()
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:771: in receive
    self.task.result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:438: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:761: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:149: in __call__
    await self.app(scope, receive, send)
backend/app/core/rate_limiting.py:371: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:75: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:55: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:707: in __call__
    await self.lifespan(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:677: in lifespan
    async with self.lifespan_context(app) as maybe_state:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
backend/app/main.py:34: in lifespan
    await create_tables()
backend/app/core/database.py:54: in create_tables
    async with engine.begin() as conn:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:1061: in begin
    async with conn:
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/base.py:125: in __aenter__
    return await self.start(is_ctxmanager=True)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:270: in start
    await greenlet_spawn(self.sync_engine.connect)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:190: in greenlet_spawn
    result = context.throw(*sys.exc_info())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3268: in connect
    return self._connection_cls(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:145: in __init__
    self._dbapi_connection = engine.raw_connection()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3292: in raw_connection
    return self.pool.connect()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:452: in connect
    return _ConnectionFairy._checkout(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1378: in _checkout
    del fairy
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1306: in _checkout
    result = pool._dialect._do_ping_w_event(
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/default.py:709: in _do_ping_w_event
    return self.do_ping(dbapi_connection)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1137: in do_ping
    dbapi_connection.ping()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:829: in ping
    self._handle_exception(error)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:810: in _handle_exception
    raise error
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:827: in ping
    _ = self.await_(self._async_ping())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:125: in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:185: in greenlet_spawn
    value = await result
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:836: in _async_ping
    await tr.start()
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/transaction.py:146: in start
    await self._connection.execute(query)
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/connection.py:350: in execute
    result = await self._protocol.query(query, timeout)
asyncpg/protocol/protocol.pyx:374: in query
    ???
E   RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop</error></testcase><testcase classname="tests.integration.test_api_endpoints.TestUsersAPI" name="test_get_current_user_profile" time="0.045"><failure message="TypeError: 'coroutine' object is not iterable">tests/integration/test_api_endpoints.py:217: in test_get_current_user_profile
    response = test_client.get("/api/v1/users/profile", headers=auth_headers)
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:499: in get
    return super().get(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1041: in get
    return self.request(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in request
    return super().request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:801: in request
    request = self.build_request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:347: in build_request
    headers = self._merge_headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:414: in _merge_headers
    merged_headers.update(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:199: in update
    headers = Headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:79: in __init__
    self._list = [
E   TypeError: 'coroutine' object is not iterable</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestTenantsAPI" name="test_get_tenants" time="0.006"><error message="failed on setup with &quot;RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop&quot;">tests/conftest.py:71: in test_client
    with TestClient(app) as client:
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:745: in __enter__
    portal.call(self.wait_startup)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:780: in wait_startup
    await receive()
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:771: in receive
    self.task.result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:438: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:761: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:149: in __call__
    await self.app(scope, receive, send)
backend/app/core/rate_limiting.py:371: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:75: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:55: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:707: in __call__
    await self.lifespan(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:677: in lifespan
    async with self.lifespan_context(app) as maybe_state:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
backend/app/main.py:34: in lifespan
    await create_tables()
backend/app/core/database.py:54: in create_tables
    async with engine.begin() as conn:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:1061: in begin
    async with conn:
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/base.py:125: in __aenter__
    return await self.start(is_ctxmanager=True)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:270: in start
    await greenlet_spawn(self.sync_engine.connect)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:190: in greenlet_spawn
    result = context.throw(*sys.exc_info())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3268: in connect
    return self._connection_cls(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:145: in __init__
    self._dbapi_connection = engine.raw_connection()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3292: in raw_connection
    return self.pool.connect()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:452: in connect
    return _ConnectionFairy._checkout(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1378: in _checkout
    del fairy
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1306: in _checkout
    result = pool._dialect._do_ping_w_event(
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/default.py:709: in _do_ping_w_event
    return self.do_ping(dbapi_connection)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1137: in do_ping
    dbapi_connection.ping()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:829: in ping
    self._handle_exception(error)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:810: in _handle_exception
    raise error
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:827: in ping
    _ = self.await_(self._async_ping())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:125: in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:185: in greenlet_spawn
    value = await result
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:836: in _async_ping
    await tr.start()
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/transaction.py:146: in start
    await self._connection.execute(query)
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/connection.py:350: in execute
    result = await self._protocol.query(query, timeout)
asyncpg/protocol/protocol.pyx:374: in query
    ???
E   RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop</error></testcase><testcase classname="tests.integration.test_api_endpoints.TestRolesAPI" name="test_get_roles" time="0.035"><failure message="TypeError: 'coroutine' object is not iterable">tests/integration/test_api_endpoints.py:244: in test_get_roles
    response = test_client.get("/api/v1/roles", headers=auth_headers)
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:499: in get
    return super().get(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1041: in get
    return self.request(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in request
    return super().request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:801: in request
    request = self.build_request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:347: in build_request
    headers = self._merge_headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:414: in _merge_headers
    merged_headers.update(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:199: in update
    headers = Headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:79: in __init__
    self._list = [
E   TypeError: 'coroutine' object is not iterable</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestMultiTenantIsolation" name="test_tenant_isolation_articles" time="0.005"><error message="failed on setup with &quot;RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop&quot;">tests/conftest.py:71: in test_client
    with TestClient(app) as client:
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:745: in __enter__
    portal.call(self.wait_startup)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:780: in wait_startup
    await receive()
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:771: in receive
    self.task.result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:438: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:761: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:149: in __call__
    await self.app(scope, receive, send)
backend/app/core/rate_limiting.py:371: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:75: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:55: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:707: in __call__
    await self.lifespan(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:677: in lifespan
    async with self.lifespan_context(app) as maybe_state:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
backend/app/main.py:34: in lifespan
    await create_tables()
backend/app/core/database.py:54: in create_tables
    async with engine.begin() as conn:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:1061: in begin
    async with conn:
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/base.py:125: in __aenter__
    return await self.start(is_ctxmanager=True)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:270: in start
    await greenlet_spawn(self.sync_engine.connect)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:190: in greenlet_spawn
    result = context.throw(*sys.exc_info())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3268: in connect
    return self._connection_cls(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:145: in __init__
    self._dbapi_connection = engine.raw_connection()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3292: in raw_connection
    return self.pool.connect()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:452: in connect
    return _ConnectionFairy._checkout(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1378: in _checkout
    del fairy
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1306: in _checkout
    result = pool._dialect._do_ping_w_event(
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/default.py:709: in _do_ping_w_event
    return self.do_ping(dbapi_connection)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1137: in do_ping
    dbapi_connection.ping()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:829: in ping
    self._handle_exception(error)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:810: in _handle_exception
    raise error
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:827: in ping
    _ = self.await_(self._async_ping())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:125: in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:185: in greenlet_spawn
    value = await result
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:836: in _async_ping
    await tr.start()
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/transaction.py:146: in start
    await self._connection.execute(query)
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/connection.py:350: in execute
    result = await self._protocol.query(query, timeout)
asyncpg/protocol/protocol.pyx:374: in query
    ???
E   RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop</error></testcase><testcase classname="tests.integration.test_api_endpoints.TestErrorHandling" name="test_invalid_article_slug" time="0.058"><failure message="TypeError: 'coroutine' object is not iterable">tests/integration/test_api_endpoints.py:301: in test_invalid_article_slug
    response = test_client.post(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:590: in post
    return super().post(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1132: in post
    return self.request(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in request
    return super().request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:801: in request
    request = self.build_request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:347: in build_request
    headers = self._merge_headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:414: in _merge_headers
    merged_headers.update(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:199: in update
    headers = Headers(headers)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_models.py:79: in __init__
    self._list = [
E   TypeError: 'coroutine' object is not iterable</failure></testcase><testcase classname="tests.integration.test_api_endpoints.TestErrorHandling" name="test_article_not_found" time="0.006"><error message="failed on setup with &quot;RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop&quot;">tests/conftest.py:71: in test_client
    with TestClient(app) as client:
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:745: in __enter__
    portal.call(self.wait_startup)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:780: in wait_startup
    await receive()
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:771: in receive
    self.task.result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:438: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:761: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:149: in __call__
    await self.app(scope, receive, send)
backend/app/core/rate_limiting.py:371: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:26: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:75: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:55: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:707: in __call__
    await self.lifespan(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:677: in lifespan
    async with self.lifespan_context(app) as maybe_state:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
backend/app/main.py:34: in lifespan
    await create_tables()
backend/app/core/database.py:54: in create_tables
    async with engine.begin() as conn:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:175: in __aenter__
    return await self.gen.__anext__()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:1061: in begin
    async with conn:
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/base.py:125: in __aenter__
    return await self.start(is_ctxmanager=True)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/ext/asyncio/engine.py:270: in start
    await greenlet_spawn(self.sync_engine.connect)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:190: in greenlet_spawn
    result = context.throw(*sys.exc_info())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3268: in connect
    return self._connection_cls(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:145: in __init__
    self._dbapi_connection = engine.raw_connection()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/base.py:3292: in raw_connection
    return self.pool.connect()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:452: in connect
    return _ConnectionFairy._checkout(self)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1378: in _checkout
    del fairy
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/pool/base.py:1306: in _checkout
    result = pool._dialect._do_ping_w_event(
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/engine/default.py:709: in _do_ping_w_event
    return self.do_ping(dbapi_connection)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:1137: in do_ping
    dbapi_connection.ping()
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:829: in ping
    self._handle_exception(error)
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:810: in _handle_exception
    raise error
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:827: in ping
    _ = self.await_(self._async_ping())
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:125: in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/util/_concurrency_py3k.py:185: in greenlet_spawn
    value = await result
../../../Library/Python/3.9/lib/python/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:836: in _async_ping
    await tr.start()
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/transaction.py:146: in start
    await self._connection.execute(query)
../../../Library/Python/3.9/lib/python/site-packages/asyncpg/connection.py:350: in execute
    result = await self._protocol.query(query, timeout)
asyncpg/protocol/protocol.pyx:374: in query
    ???
E   RuntimeError: Task &lt;Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=&lt;BlockingPortal._call_func() running at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217&gt; cb=[TaskGroup._spawn.&lt;locals&gt;.task_done() at /Users/untalcamilomedina/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py:661]&gt; got Future &lt;Future pending cb=[Protocol._on_waiter_completed()]&gt; attached to a different loop</error></testcase><testcase classname="tests.integration.test_api_endpoints.TestErrorHandling" name="test_unauthorized_access" time="0.034"><failure message="fastapi.exceptions.HTTPException">../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:98: in receive
    return self.receive_nowait()
../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:93: in receive_nowait
    raise WouldBlock
E   anyio.WouldBlock

During handling of the above exception, another exception occurred:
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:78: in call_next
    message = await recv_stream.receive()
../../../Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py:118: in receive
    raise EndOfStream
E   anyio.EndOfStream

During handling of the above exception, another exception occurred:
tests/integration/test_api_endpoints.py:328: in test_unauthorized_access
    response = test_client.get(endpoint)
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:499: in get
    return super().get(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1041: in get
    return self.request(
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in request
    return super().request(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:342: in handle_request
    raise exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:339: in handle_request
    portal.call(self.app, scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:184: in __call__
    raise exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:162: in __call__
    await self.app(scope, receive, _send)
backend/app/core/rate_limiting.py:423: in __call__
    await self.app(scope, receive, send_with_headers)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/middleware/compression.py:124: in dispatch
    response = await call_next(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/middleware/compression.py:35: in dispatch
    response = await call_next(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/core/audit_logging.py:601: in log_request_middleware
    response = await call_next(request)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
backend/app/core/middleware.py:101: in tenant_context_middleware
    raise e
backend/app/core/middleware.py:57: in tenant_context_middleware
    raise HTTPException(
E   fastapi.exceptions.HTTPException</failure></testcase><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_imports_work" time="0.012" /><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_core_components_initialization" time="0.000" /><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_configuration_loading" time="0.000"><failure message="Failed: Configuration loading failed: assert False&#10; +  where False = hasattr(Settings(API_V1_STR='/api/v1', SECRET_KEY='aiAN-EJr_7d99HrwDkkpecWiRhETy-_L47YOchG8hGY', ACCESS_TOKEN_EXPIRE_MINUTES=11520, SERVER_NAME='Proyecto Semilla', SERVER_HOST=Url('http://localhost/'), DEBUG=True, BACKEND_CORS_ORIGINS=[Url('http://localhost:3000/'), Url('http://localhost:8000/')], ALLOWED_HOSTS=['localhost', '127.0.0.1'], DATABASE_URL='postgresql://admin:changeme123@localhost:5432/proyecto_semilla', REDIS_URL='redis://localhost:6379', RATE_LIMIT_REQUESTS=100, RATE_LIMIT_WINDOW=60, JWT_SECRET='your_jwt_secret_key_here_change_this_in_production', JWT_ALGORITHM='HS256', REFRESH_TOKEN_EXPIRE_DAYS=30, SMTP_TLS=True, SMTP_PORT=None, SMTP_HOST=None, SMTP_USER=None, SMTP_PASSWORD=None, EMAILS_FROM_EMAIL='noreply@proyectosemilla.dev', EMAILS_FROM_NAME='Proyecto Semilla', LOG_LEVEL='INFO', LOG_FORMAT='json'), 'PROJECT_NAME')">tests/integration/test_basic_integration.py:61: in test_configuration_loading
    assert hasattr(settings, 'PROJECT_NAME')
E   AssertionError: assert False
E    +  where False = hasattr(Settings(API_V1_STR='/api/v1', SECRET_KEY='aiAN-EJr_7d99HrwDkkpecWiRhETy-_L47YOchG8hGY', ACCESS_TOKEN_EXPIRE_MINUTES=11520, SERVER_NAME='Proyecto Semilla', SERVER_HOST=Url('http://localhost/'), DEBUG=True, BACKEND_CORS_ORIGINS=[Url('http://localhost:3000/'), Url('http://localhost:8000/')], ALLOWED_HOSTS=['localhost', '127.0.0.1'], DATABASE_URL='postgresql://admin:changeme123@localhost:5432/proyecto_semilla', REDIS_URL='redis://localhost:6379', RATE_LIMIT_REQUESTS=100, RATE_LIMIT_WINDOW=60, JWT_SECRET='your_jwt_secret_key_here_change_this_in_production', JWT_ALGORITHM='HS256', REFRESH_TOKEN_EXPIRE_DAYS=30, SMTP_TLS=True, SMTP_PORT=None, SMTP_HOST=None, SMTP_USER=None, SMTP_PASSWORD=None, EMAILS_FROM_EMAIL='noreply@proyectosemilla.dev', EMAILS_FROM_NAME='Proyecto Semilla', LOG_LEVEL='INFO', LOG_FORMAT='json'), 'PROJECT_NAME')

During handling of the above exception, another exception occurred:
tests/integration/test_basic_integration.py:71: in test_configuration_loading
    pytest.fail(f"Configuration loading failed: {e}")
E   Failed: Configuration loading failed: assert False
E    +  where False = hasattr(Settings(API_V1_STR='/api/v1', SECRET_KEY='aiAN-EJr_7d99HrwDkkpecWiRhETy-_L47YOchG8hGY', ACCESS_TOKEN_EXPIRE_MINUTES=11520, SERVER_NAME='Proyecto Semilla', SERVER_HOST=Url('http://localhost/'), DEBUG=True, BACKEND_CORS_ORIGINS=[Url('http://localhost:3000/'), Url('http://localhost:8000/')], ALLOWED_HOSTS=['localhost', '127.0.0.1'], DATABASE_URL='postgresql://admin:changeme123@localhost:5432/proyecto_semilla', REDIS_URL='redis://localhost:6379', RATE_LIMIT_REQUESTS=100, RATE_LIMIT_WINDOW=60, JWT_SECRET='your_jwt_secret_key_here_change_this_in_production', JWT_ALGORITHM='HS256', REFRESH_TOKEN_EXPIRE_DAYS=30, SMTP_TLS=True, SMTP_PORT=None, SMTP_HOST=None, SMTP_USER=None, SMTP_PASSWORD=None, EMAILS_FROM_EMAIL='noreply@proyectosemilla.dev', EMAILS_FROM_NAME='Proyecto Semilla', LOG_LEVEL='INFO', LOG_FORMAT='json'), 'PROJECT_NAME')</failure></testcase><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_database_connection_config" time="0.000" /><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_security_settings" time="0.000" /><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_metrics_system_basic_functionality" time="0.000" /><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_alerting_system_basic_functionality" time="0.000" /><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_circuit_breaker_basic_functionality" time="0.000" /><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_error_handler_basic_functionality" time="0.000" /><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_file_structure_integrity" time="0.000"><failure message="AssertionError: Critical file missing: requirements.txt&#10;assert False&#10; +  where False = &lt;function exists at 0x102b75670&gt;('requirements.txt')&#10; +    where &lt;function exists at 0x102b75670&gt; = &lt;module 'posixpath' from '/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/posixpath.py'&gt;.exists&#10; +      where &lt;module 'posixpath' from '/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/posixpath.py'&gt; = &lt;module 'os' from '/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/os.py'&gt;.path">tests/integration/test_basic_integration.py:201: in test_file_structure_integrity
    assert os.path.exists(file_path), f"Critical file missing: {file_path}"
E   AssertionError: Critical file missing: requirements.txt
E   assert False
E    +  where False = &lt;function exists at 0x102b75670&gt;('requirements.txt')
E    +    where &lt;function exists at 0x102b75670&gt; = &lt;module 'posixpath' from '/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/posixpath.py'&gt;.exists
E    +      where &lt;module 'posixpath' from '/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/posixpath.py'&gt; = &lt;module 'os' from '/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/os.py'&gt;.path</failure></testcase><testcase classname="tests.integration.test_basic_integration.TestBasicIntegration" name="test_package_structure" time="0.000" /></testsuite></testsuites>